(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{293:function(s,t,a){"use strict";a.r(t);var n=a(12),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nginx总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx总结"}},[s._v("#")]),s._v(" nginx总结")]),s._v(" "),t("blockquote",[t("p",[s._v("参考资料:")]),s._v(" "),t("p",[s._v("1、"),t("a",{attrs:{href:"https://www.hangge.com/blog/cache/detail_2979.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx反向代理location和proxy_pass参数"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("2、"),t("a",{attrs:{href:"https://blog.csdn.net/u010391029/article/details/50395680",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx之proxy_redirect详解"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("3、"),t("a",{attrs:{href:"https://blog.csdn.net/weixin_43122090/article/details/105461971",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx面试题"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("4、"),t("a",{attrs:{href:"https://blog.csdn.net/wangbin_0729/article/details/82109693",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx配置文件详解"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("5、"),t("a",{attrs:{href:"https://blog.csdn.net/tjcyjd/article/details/50695922",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx配置文件解析"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"_1、简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、简介"}},[s._v("#")]),s._v(" 1、简介")]),s._v(" "),t("h3",{attrs:{id:"_1、nginx简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、nginx简介"}},[s._v("#")]),s._v(" 1、nginx简介")]),s._v(" "),t("p",[s._v("Nginx是一个轻量级、高性能的反向代理Web服务器，他实现非常高效的反向代理、负载平衡，他可以处理2-3万并发连接数，官方监测能支持5万并发。")]),s._v(" "),t("h3",{attrs:{id:"_2、优缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、优缺点"}},[s._v("#")]),s._v(" 2、优缺点")]),s._v(" "),t("ul",[t("li",[s._v("优点\n"),t("ul",[t("li",[s._v("占内存小，高并发处理响应快：开启10个nginx才占150M内存、2-3万并发连接数")]),s._v(" "),t("li",[s._v("配置简单，功能强大：可实现http服务器、虚拟主机、反向代理、负载均衡")]),s._v(" "),t("li",[s._v("稳定性高，节省带宽：宕机的概率非常小，支持GZIP压缩，可以添加浏览器本地缓存")])])]),s._v(" "),t("li",[s._v("缺点：nginx处理静态文件好,耗费内存少，动态处理差例如处理动态页面，一般前端用nginx作为反向代理抗住压力")])]),s._v(" "),t("h3",{attrs:{id:"_3、应用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、应用场景"}},[s._v("#")]),s._v(" 3、应用场景")]),s._v(" "),t("ul",[t("li",[s._v("http服务器：可以独立提供http服务，做网页静态服务器。")]),s._v(" "),t("li",[s._v("虚拟主机：可以实现在一台服务器虚拟出多个网站，例如个人网站使用的虚拟机。")]),s._v(" "),t("li",[s._v("反向代理，负载均衡：当网站的访问量达到一定程度后，单台服务器不能满足用户的请求时，需要用多台服务器集群可以使用nginx做反向代理。并且多台服务器可以平均分担负载，不会应为某台服务器负载高宕机而某台服务器闲置的情况。")]),s._v(" "),t("li",[s._v("安全控制：可以配置安全管理、比如防sql注入，比如可以使用Nginx搭建API接口网关，对每个接口服务进行拦截。")])]),s._v(" "),t("h3",{attrs:{id:"_3、正向与反向代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、正向与反向代理"}},[s._v("#")]),s._v(" 3、正向与反向代理")]),s._v(" "),t("ul",[t("li",[s._v("正向代理（发送请求方的代理）\n"),t("ul",[t("li",[s._v("正向代理屏蔽客户端，当我们想要访问外网时，先经过正向代理服务器，去帮我们访问互联网")]),s._v(" "),t("li",[s._v("正向代理可以添加访问资源的控制策略")])])]),s._v(" "),t("li",[s._v("反向代理（服务接收方的代理）\n"),t("ul",[t("li",[s._v("反向代理屏蔽服务器，当外网想访问我们的服务器时，先访问反向代理服务器，再转发到我们的服务器")]),s._v(" "),t("li",[s._v("对服务器起到保护作用，隐藏源服务器的存在和特性，用于安全控制，可充当互联网云和web服务器的中间层")]),s._v(" "),t("li",[s._v("应用：解决“同源策略”造成的跨域问题，浏览器发送请求后，统一被nginx反向代理服务器接收，不同路由通过location+upstream进行分发给后端的业务处理服务器进行处理")])])])]),s._v(" "),t("h2",{attrs:{id:"_2、nginx配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、nginx配置"}},[s._v("#")]),s._v(" 2、nginx配置")]),s._v(" "),t("h3",{attrs:{id:"_1、程序目录结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、程序目录结构"}},[s._v("#")]),s._v(" 1、程序目录结构")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree /usr/local/nginx")]),s._v("\n/usr/local/nginx\n├── client_body_temp\n├── conf                             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Nginx所有配置文件的目录")]),s._v("\n│   ├── fastcgi.conf                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# fastcgi相关参数的配置文件")]),s._v("\n│   ├── fastcgi.conf.default         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# fastcgi.conf的原始备份文件")]),s._v("\n│   ├── fastcgi_params               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# fastcgi的参数文件")]),s._v("\n│   ├── fastcgi_params.default       \n│   ├── koi-utf\n│   ├── koi-win\n│   ├── mime.types                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 媒体类型")]),s._v("\n│   ├── mime.types.default\n│   ├── nginx.conf                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Nginx主配置文件")]),s._v("\n│   ├── nginx.conf.default\n│   ├── scgi_params                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scgi相关参数文件")]),s._v("\n│   ├── scgi_params.default  \n│   ├── uwsgi_params                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# uwsgi相关参数文件")]),s._v("\n│   ├── uwsgi_params.default\n│   └── win-utf\n├── fastcgi_temp                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# fastcgi临时数据目录")]),s._v("\n├── html                             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Nginx默认站点目录")]),s._v("\n│   ├── 50x.html                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 错误页面优雅替代显示文件，例如当出现502错误时会调用此页面")]),s._v("\n│   └── index.html                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认的首页文件")]),s._v("\n├── logs                             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Nginx日志目录")]),s._v("\n│   ├── access.log                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问日志文件")]),s._v("\n│   ├── error.log                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 错误日志文件")]),s._v("\n│   └── nginx.pid                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pid文件，Nginx进程启动后，会把所有进程的ID号写到此文件")]),s._v("\n├── proxy_temp                       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时目录")]),s._v("\n├── sbin                             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Nginx命令目录")]),s._v("\n│   └── nginx                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Nginx的启动命令")]),s._v("\n├── scgi_temp                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时目录")]),s._v("\n└── uwsgi_temp                       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时目录")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br")])]),t("h3",{attrs:{id:"_2、配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、配置文件"}},[s._v("#")]),s._v(" 2、配置文件")]),s._v(" "),t("h4",{attrs:{id:"_1、总体简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、总体简介"}},[s._v("#")]),s._v(" 1、总体简介")]),s._v(" "),t("p",[s._v("nginx.conf由多个块组成，最外面的块是main，main包含Events和HTTP，HTTP包含upstream和多个Server，Server又包含多个location：main（全局设置）、server（主机设置）、upstream（负载均衡服务器设置）和 location（URL匹配特定位置的设置）。")]),s._v(" "),t("ul",[t("li",[s._v("main块设置的指令将影响其他所有设置；")]),s._v(" "),t("li",[s._v("server块的指令主要用于指定主机和端口；")]),s._v(" "),t("li",[s._v("upstream指令主要用于负载均衡，设置一系列的后端服务器；")]),s._v(" "),t("li",[s._v("location块用于匹配网页位置。")])]),s._v(" "),t("p",[s._v("这四者之间的关系式：server继承main，location继承server，upstream既不会继承其他设置也不会被继承。\n在这四个部分当中，每个部分都包含若干指令，这些指令主要包含Nginx的主模块指令、事件模块指令、HTTP核心模块指令，同时每个部分还可以使用其他HTTP模块指令，例如Http SSL模块、HttpGzip Static模块和Http Addition模块等。")]),s._v(" "),t("img",{attrs:{src:"/img/nginxconf.png"}}),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("user root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主模块指令，指定Nginx Worker进程运行用户以及用户组")]),s._v("\nworker_processes  auto；          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定nginx要开启的进程树，每个进程平均耗费10M-12M内存，建议和cpu的数量一致")]),s._v("\nerror_log  /data/nginx/log/error.log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#全局错误日志文件,日志输出级别有debug、info、notice、warn、error、crit可供选择")]),s._v("\npid /data/nginx/log/nginx.pid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用来指定进程pid（进程标识符）的存储文件位置")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 事件区块开始")]),s._v("\nevents "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("                            \n    worker_connections  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("；      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个worker进程支持的最大连接数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTP区块开始")]),s._v("\nhttp "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("                              \n    include       mime.types；      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Nginx支持的媒体类型库文件，类型由mime.type文件定义")]),s._v("\n    default_type  text/plain；      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认的媒体类型")]),s._v("\n    sendfile        on；       \t\t "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启高效传输模式")]),s._v("\n    keepalive_timeout  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v("；       \t "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接超时")]),s._v("\n    server_tokens off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭nginx版本提示")]),s._v("\n    client_max_body_size 50m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置允许客户端请求的最大的单个文件字节数")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启gzip压缩输出，减少网络传输")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#log_format是Nginx的HttpLog模块指令，用于指定Nginx日志的输出格式， main和log404为此日志输出格式的名称")]),s._v("\n    log_format main "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    log_format log404 "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$status [$time_local] $remote_addr $host$request_uri $sent_http_location'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定了一个负载均衡器的名称subloanIntrantDomain,在后面需要的地方直接调用即可。")]),s._v("\n    upstream subloanIntrantDomain "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认策略为轮训")]),s._v("\n    \t\tip_hash"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#hash $request_uri;")]),s._v("\n    \t  server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.70")]),s._v(".77.84:9081"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \t  server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.70")]),s._v(".77.84:9090 down"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当前的server暂时不参与负载均衡")]),s._v("\n    \t  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许请求失败的次数3,当超过最大次数时，返回proxy_next_upstream 模块定义的错误；")]),s._v("\n    \t  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在经历了max_fails次失败后，暂停服务的时间20s")]),s._v("\n    \t  server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.70")]),s._v(".77.84:9091 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_fails")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fail_timeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("20s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第一个Server区块开始，表示一个独立的虚拟主机站点")]),s._v("\n    server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("            \t\t\t\t\t\t\t\t\n        listen       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("；      \t\t\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 提供服务的端口，默认80")]),s._v("\n        server_name  localhost；       \t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 提供服务的域名主机名")]),s._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置日志按照时间进行分割，$year-$month-$day-$hour-access.log定义按天进行分割")]),s._v("\n        if"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$time_iso8601")]),s._v(" ~ "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        \t "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$year")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \t "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$month")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \t "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$day")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \t "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$hour")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \t "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$minutes")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \t "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$seconds")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log用来指定此虚拟主机的访问日志存放路径，最后的main用于指定访问日志的输出格式")]),s._v("\n        access_log /data/nginx/log/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$year")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$month")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$day")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$hour")]),s._v("-access.log main"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第一个location区块开始，动态请求")]),s._v("\n        location ^~ /ICBCWAPBankB7HR/api/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        \tproxy_http_version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \tproxy_set_header Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \tproxy_set_header X-Real-IP "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#记录客户端ip，被HTTP代理用来表示与它产生TCP连接的设备IP")]),s._v("\n        \tproxy_set_header X-Forwarder-For "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#记录HTTP请求端真实IP")]),s._v("\n        \t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#以上三行，目的是将代理服务器收到的用户的信息传到真实服务器上")]),s._v("\n        \tproxy_set_header Accept-Encording "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \tproxy_set_header Connection "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Keep-Alive"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \tproxy_pass http://subloanIntrantDomain/ICBCWAPBankB7HR/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \tproxy_redirect off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        \n         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第二个location区块开始，静态页面")]),s._v("\n        location ^~ /ICBCWAPBankB7HR/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("alias")]),s._v(" /data/nginx/client/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#http://xxxx/ICBCWAPBankB7HR/ ->访问：/data/nginx/client/")]),s._v("\n          index index.html"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认的首页文件，多个用空格分开")]),s._v("\n          add_header X-Frame-options "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SAMEORIGIN'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#同源可在 <frame>, </iframe> 或者 <object> 中展现")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启用XSS过滤，如果检测到攻击，浏览器将不会清除页面，而是阻止页面加载")]),s._v("\n          add_header X-XSS-Protection "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1;mode=block'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n          add_header X-Content-Type-Options "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'nosniff'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          expires 4h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#缓存4h")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      \t\t\t\t\t\t\t\t\t\n        error_page   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("403")]),s._v("  /error.html；     \t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 出现对应的http状态码时，使用error.html回应客户")]),s._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# location区块开始，访问50x.html")]),s._v("\n        location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /err.html "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("          \t\t\n            root /ICBCWAPBankB7HR；      \t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定对应的站点目录为html")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##安全控制，防sql注入以及xss")]),s._v("\n    if"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_method")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("~* GET"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("POST"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("PUT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("DELETE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \t"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("444")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br")])]),t("h4",{attrs:{id:"_2、location描述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、location描述"}},[s._v("#")]),s._v(" 2、location描述")]),s._v(" "),t("p",[s._v("location指令的作用是根据用户请求的URI来执行不同的应用，也就是根据用户请求的网站URL进行匹配，匹配成功即进行相关的操作。location支持正则表达式匹配，也支持条件判断匹配，用户可以通过location指令实现Nginx对动、静态网页进行过滤处理。使用location URL匹配配置还可以实现反向代理，用于实现PHP动态解析或者负载负载均衡。")]),s._v(" "),t("ul",[t("li",[s._v("语法")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("匹配符")]),s._v(" "),t("th",[s._v("匹配规则")]),s._v(" "),t("th",[s._v("优先级")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("=")]),s._v(" "),t("td",[s._v("精确匹配")]),s._v(" "),t("td",[s._v("1")])]),s._v(" "),t("tr",[t("td",[s._v("^~")]),s._v(" "),t("td",[s._v("以某个字符串开头")]),s._v(" "),t("td",[s._v("2")])]),s._v(" "),t("tr",[t("td",[s._v("~")]),s._v(" "),t("td",[s._v("区分大小写的正则匹配")]),s._v(" "),t("td",[s._v("3")])]),s._v(" "),t("tr",[t("td",[s._v("~*")]),s._v(" "),t("td",[s._v("不区分大小写的正则匹配")]),s._v(" "),t("td",[s._v("4")])]),s._v(" "),t("tr",[t("td",[s._v("!~")]),s._v(" "),t("td",[s._v("区分大小写不匹配的正则")]),s._v(" "),t("td",[s._v("5")])]),s._v(" "),t("tr",[t("td",[s._v("!~*")]),s._v(" "),t("td",[s._v("不区分大小写不匹配的正则")]),s._v(" "),t("td",[s._v("6")])]),s._v(" "),t("tr",[t("td",[s._v("/")]),s._v(" "),t("td",[s._v("通用匹配，任何请求都会匹配到")]),s._v(" "),t("td",[s._v("7")])])])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#优先级1,精确匹配，根路径，eg：https://baidu.com.cn/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" =/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#优先级2,以某个字符串开头, 从域名开始以av开头的，优先匹配这里，区分大小写，～代表输入字符")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#eg: https://baidu.com.cn/av/login/匹配，https://baidu.com.cn/login/av不匹配")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#root实际访问路径：https://baidu.com.cn/data/av/av/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~ /av")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /data/av/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#优先级3，区分大小写的正则匹配，匹配/media*****路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~ /media")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /data/static/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#优先级4 ，不区分大小写的正则匹配，所有的****.jpg|gif|png 都走这里")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~* .*\\.(jpg|gif|png|js|css)$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("  /data/av/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#优先7，通用匹配")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("403")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("ul",[t("li",[s._v("常用指令\n"),t("ul",[t("li",[s._v("proxy_pass：代理转发\n"),t("ul",[t("li",[s._v("url加上/为绝对路径，则 Nginx不会把 location 中匹配的路径部分加入代理 uri")]),s._v(" "),t("li",[s._v("url不加/，则 Nginx会把 location 中匹配的路径部分加入代理 uri")])])]),s._v(" "),t("li",[s._v("proxy_redirect：修改被代理服务器返回的响应头中的location头域跟refresh头域数值\n"),t("ul",[t("li",[s._v("值为：default|off|redirect replacement\n"),t("ul",[t("li",[s._v("default：默认")]),s._v(" "),t("li",[s._v("off：禁止所有的proxy_redirect指令")])])]),s._v(" "),t("li",[s._v("代替的字段中可以不写服务器名，使用\\ ，使用服务器的基本名称和端口")])])]),s._v(" "),t("li",[s._v("nginx指定文件路径有两种方式root和alias，root与alias主要区别在于nginx如何解释location后面的uri，这会使两者分别以不同的方式将请求映射到服务器文件上,说白了就是两者拼接文件路径的手段不一样。\n"),t("ul",[t("li",[s._v("root的处理结果是：root路径＋location路径")]),s._v(" "),t("li",[s._v("alias的处理结果是：使用alias路径替换location路径")])])]),s._v(" "),t("li",[s._v("expires：设置缓存时间\n"),t("ul",[t("li",[s._v("时间戳会设置expires报文头")]),s._v(" "),t("li",[s._v("正数或零：设置cache-control：max-age=x")]),s._v(" "),t("li",[s._v("负数：nocache")])])]),s._v(" "),t("li",[s._v("proxy_cache：服务器的缓存配置，可在转发请求时对资源进行缓存")])])])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  www.boke.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    //重定向至该地址和端口\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://192.168.1.154:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    //修改返回的响应头中的location\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v(" http://192.168.1.154:8080/wuman/  http://www.boke.com/wuman/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#测试")]),s._v("\n[root@localhost "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("nginx]#")]),s._v(" curl -I http://www.boke.com/wuman\nHTTP/1.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" Moved Permanently\nServer: nginx\nDate: Thu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" Dec "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2015")]),s._v(" 12:08:34 GMT\nContent-Type: text/html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("charset=iso-8859-1")]),s._v("\nConnection: keep-alive\nLocation: http://www.boke.com/wuman/\n\n\n//4h的强缓存\nlocation ^~ /xxxx/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /data/nginx/client/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4h")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("h4",{attrs:{id:"_3、负载均衡配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、负载均衡配置"}},[s._v("#")]),s._v(" 3、负载均衡配置")]),s._v(" "),t("p",[s._v("upstream是Nginx的HTTP Upstream模块，这个模块通过一个简单的调度算法来实现客户端IP到后端服务器的负载均衡。")]),s._v(" "),t("p",[s._v("Nginx的负载均衡模块目前支持4种调度算法，后两项属于第三方的调度方法。")]),s._v(" "),t("ul",[t("li",[s._v("轮询（默认）：每个请求按时间顺序逐一分配到不同的后端服务器，如果后端某台服务器宕机，故障系统被自动剔除，使用户访问不受影响；")]),s._v(" "),t("li",[s._v("Weight：指定轮询权值，Weight值越大，分配到的访问机率越高，主要用于后端每个服务器性能不均的情况下；")]),s._v(" "),t("li",[s._v("ip_hash：每个请求按访问IP的hash结果分配，这样来自同一个IP的访客固定访问一个后端服务器，有效解决了动态网页存在的session共享问题；")]),s._v(" "),t("li",[s._v("fair：比上面两个更加智能的负载均衡算法。此种算法可以依据页面大小和加载时间长短智能地进行负载均衡，也就是根据后端服务器的响应时间来分配请求，响应时间短的优先分配。Nginx本身是不支持fair的，如果需要使用这种调度算法，必须下载Nginx的upstream_fair模块；")]),s._v(" "),t("li",[s._v("url_hash：按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，可以进一步提高后端缓存服务器的效率。Nginx本身是不支持url_hash的，如果需要使用这种调度算法，必须安装Nginx 的hash软件包。")])]),s._v(" "),t("p",[s._v("在HTTP Upstream模块中，可以通过server指令指定后端服务器的IP地址和端口，同时还可以设定每个后端服务器在负载均衡调度中的状态。常用的状态有：")]),s._v(" "),t("ul",[t("li",[s._v("down：表示当前的server暂时不参与负载均衡；")]),s._v(" "),t("li",[s._v("backup：预留的备份机器。当其他所有的非backup机器出现故障或者忙的时候，才会请求backup机器，因此这台机器的压力最轻；")]),s._v(" "),t("li",[s._v("max_fails：允许请求失败的次数，默认为1。当超过最大次数时，返回proxy_next_upstream 模块定义的错误；")]),s._v(" "),t("li",[s._v("fail_timeout：在经历了max_fails次失败后，暂停服务的时间。max_fails可以和fail_timeout一起使用。")])]),s._v(" "),t("p",[s._v("注意，当负载调度算法为ip_hash时，后端服务器在负载均衡调度中的状态不能是weight和backup。")]),s._v(" "),t("h4",{attrs:{id:"_4、使用变量解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、使用变量解析"}},[s._v("#")]),s._v(" 4、使用变量解析")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("日志格式设置：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("$remote_addr与$http_x_forwarded_for用以记录客户端的ip地址；")])]),s._v(" "),t("li",[t("p",[s._v("$remote_user：用来记录客户端用户名称；")])]),s._v(" "),t("li",[t("p",[s._v("$time_local： 用来记录访问时间与时区；")])]),s._v(" "),t("li",[t("p",[s._v("$request： 用来记录请求的url与http协议；")])]),s._v(" "),t("li",[t("p",[s._v("$status： 用来记录请求状态；成功是200，")])]),s._v(" "),t("li",[t("p",[s._v("$body_bytes_sent ：记录发送给客户端文件主体内容大小；")])]),s._v(" "),t("li",[t("p",[s._v("$http_referer：用来记录从那个页面链接访问过来的；")])]),s._v(" "),t("li",[t("p",[s._v("$http_user_agent：记录客户浏览器的相关信息；")])])]),s._v(" "),t("p",[s._v("通常web服务器放在反向代理的后面，这样就不能获取到客户的IP地址了，通过$remote_add拿到的IP地址是反向代理服务器的iP地址。反向代理服务器在转发请求的http头信息中，可以增加x_forwarded_for信息，用以记录原有客户端的IP地址和原来客户端的请求的服务器地址。")])]),s._v(" "),t("li",[t("p",[s._v("其他变量")]),s._v(" "),t("p",[s._v("$args此变量与请求行中的参数相等")]),s._v(" "),t("p",[s._v("$content_length等于请求行的“Content_Length”的值。")]),s._v(" "),t("p",[s._v("$content_type等同与请求头部的”Content_Type”的值")]),s._v(" "),t("p",[s._v("$document_root等同于当前请求的root指令指定的值")]),s._v(" "),t("p",[s._v("$document_uri与$uri一样")]),s._v(" "),t("p",[s._v("$host与请求头部中“Host”行指定的值或是request到达的server的名字（没有Host行）一样")]),s._v(" "),t("p",[s._v("$limit_rate允许限制的连接速率")]),s._v(" "),t("p",[s._v("$request_method等同于request的method，通常是“GET”或“POST”")]),s._v(" "),t("p",[s._v("$remote_addr客户端ip")]),s._v(" "),t("p",[s._v("$remote_port客户端port")]),s._v(" "),t("p",[s._v("$remote_user等同于用户名，由ngx_http_auth_basic_module认证")]),s._v(" "),t("p",[s._v("$request_filename当前请求的文件的路径名，由root或alias和URI request组合而成")]),s._v(" "),t("p",[s._v("$request_body_file")]),s._v(" "),t("p",[s._v("$request_uri含有参数的完整的初始URI")]),s._v(" "),t("p",[s._v("$query_string与$args一样")]),s._v(" "),t("p",[s._v("$sheeme http模式（http,https）尽在要求是评估例如")]),s._v(" "),t("p",[s._v("Rewrite ^(.+)$ $sheme://example.com$; Redirect;")]),s._v(" "),t("p",[s._v("$server_protocol等同于request的协议，使用“HTTP/或“HTTP/")]),s._v(" "),t("p",[s._v("$server_addr request到达的server的ip，一般获得此变量的值的目的是进行系统调用。为了避免系统调用，有必要在listen指令中指明ip，并使用bind参数。")]),s._v(" "),t("p",[s._v("$server_name请求到达的服务器名")]),s._v(" "),t("p",[s._v("$server_port请求到达的服务器的端口号")]),s._v(" "),t("p",[s._v("$uri等同于当前request中的URI，可不同于初始值，例如内部重定向时或使用index")])])]),s._v(" "),t("h3",{attrs:{id:"_3、常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、常用命令"}},[s._v("#")]),s._v(" 3、常用命令")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检测配置文件是否有语法错误，然后退出")]),s._v("\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" reopen "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启Nginx")]),s._v("\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" reload "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新加载Nginx配置文件，然后以优雅的方式重启Nginx")]),s._v("\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" stop "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#强制停止Nginx服务")]),s._v("\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" quit "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#优雅地停止Nginx服务（即处理完所有请求后再停止服务）")]),s._v("\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示版本信息并退出")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("killall")]),s._v(" nginx  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#杀死所有nginx进程")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"_4、http头部解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、http头部解析"}},[s._v("#")]),s._v(" 4、http头部解析")]),s._v(" "),t("h4",{attrs:{id:"_1、x-frame-options"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、x-frame-options"}},[s._v("#")]),s._v(" 1、X-Frame-Options")]),s._v(" "),t("p",[s._v("HTTP 响应头是用来给浏览器指示允许一个页面可否在 "),t("code",[s._v("<frame>")]),s._v(", "),t("code",[s._v("</iframe>")]),s._v(" 或者 "),t("code",[s._v("<object>")]),s._v("中展现的标记")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("DENY：表示该页面不允许在frame中展示，即便是在相同域名的页面中嵌套也不允许。")])]),s._v(" "),t("li",[t("p",[s._v("SAMEORIGIN：表示该页面可以在相同域名页面的frame中展示。")])]),s._v(" "),t("li",[t("p",[s._v("ALLOW-FROM uri：表示该页面可以在指定来源的frame中展示")])])]),s._v(" "),t("h4",{attrs:{id:"_2、host、x-real-ip、x-forwarder-for"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、host、x-real-ip、x-forwarder-for"}},[s._v("#")]),s._v(" 2、Host、X-Real-IP、X-Forwarder-For")]),s._v(" "),t("p",[s._v("参考资料："),t("a",{attrs:{href:"https://www.runoob.com/w3cnote/http-x-forwarded-for.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("HTTP X-Forwarded-For 介绍"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("X-Forwarded-For 是一个 HTTP 扩展头部。HTTP/1.1（RFC 2616）协议并没有对它的定义，它最开始是由 Squid 这个缓存代理软件引入，用来表示 HTTP 请求端真实 IP。")]),s._v(" "),t("p",[s._v("XFF 的内容由「英文逗号 + 空格」隔开的多个部分组成，最开始的是离服务端最远的设备 IP，然后是每一级代理设备的 IP。")]),s._v(" "),t("p",[s._v("如果一个 HTTP 请求到达服务器之前，经过了三个代理 Proxy1、Proxy2、Proxy3，IP 分别为 IP1、IP2、IP3，用户真实 IP 为 IP0，那么按照 XFF 标准，服务端最终会收到以下信息：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("X-Forwarded-For: IP0, IP1, IP2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("X-Real-IP 通常被 HTTP 代理用来表示与它产生 TCP 连接的设备 IP，这个设备可能是其他代理，也可能是真正的请求端。需要注意的是，X-Real-IP 目前并不属于任何标准，代理和 Web 应用之间可以约定用任何自定义头来传递这个信息。")]),s._v(" "),t("p",[s._v("解析：X-Forwarded-For用于负载均衡算法，基于XFF的会话保护，对x-forwarded-for字段的内容进行hash，根据哈希结果进行负载转发，x-forwarded-for字段的内容相同，就会负载到同一台后端服务器上。其他手段：基于cookie的会话保持，安全属性httponly（只读）、secure（https传输）、same-site=none（任何第三方携带）/strict（同源携带）")]),s._v(" "),t("h4",{attrs:{id:"_3、x-xss-protection"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、x-xss-protection"}},[s._v("#")]),s._v(" 3、X-XSS-Protection")]),s._v(" "),t("p",[s._v("HTTP "),t("strong",[t("code",[s._v("X-XSS-Protection")])]),s._v(" 响应头是 Internet Explorer，Chrome 和 Safari 的一个特性，当检测到跨站脚本攻击 ("),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Glossary/Cross-site_scripting",target:"_blank",rel:"noopener noreferrer"}},[s._v("XSS (en-US)"),t("OutboundLink")],1),s._v(")时，浏览器将停止加载页面。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("X-XSS-Protection: 0\nX-XSS-Protection: 1\nX-XSS-Protection: 1; mode=block\nX-XSS-Protection: 1; report=<reporting-uri>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("0")]),s._v(" "),t("p",[s._v("禁止XSS过滤。")])]),s._v(" "),t("li",[t("p",[s._v("1")]),s._v(" "),t("p",[s._v("启用XSS过滤（通常浏览器是默认的）。 如果检测到跨站脚本攻击，浏览器将清除页面（删除不安全的部分）。")])]),s._v(" "),t("li",[t("p",[s._v("1;mode=block")]),s._v(" "),t("p",[s._v("启用XSS过滤。 如果检测到攻击，浏览器将不会清除页面，而是阻止页面加载。")])]),s._v(" "),t("li",[t("p",[s._v("1; report="),t("code",[s._v("<reporting-URI>")]),s._v("(Chromium only)")]),s._v(" "),t("p",[s._v("启用XSS过滤。 如果检测到跨站脚本攻击，浏览器将清除页面并使用CSP "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/report-uri",target:"_blank",rel:"noopener noreferrer"}},[s._v("report-uri (en-US)"),t("OutboundLink")],1),s._v("指令的功能发送违规报告。")])])]),s._v(" "),t("h4",{attrs:{id:"_4、x-content-type-options"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、x-content-type-options"}},[s._v("#")]),s._v(" 4、X-Content-Type-Options")]),s._v(" "),t("p",[t("code",[s._v("X-Content-Type-Options")]),s._v(" HTTP 消息头相当于一个提示标志，被服务器用来提示客户端一定要遵循在 "),t("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("Content-Type")]),t("OutboundLink")],1),s._v(" 首部中对 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types",target:"_blank",rel:"noopener noreferrer"}},[s._v("MIME 类型"),t("OutboundLink")],1),s._v(" 的设定，而不能对其进行修改。这就禁用了客户端的 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types#MIME_sniffing",target:"_blank",rel:"noopener noreferrer"}},[s._v("MIME 类型嗅探"),t("OutboundLink")],1),s._v("行为，换句话说，也就是意味着网站管理员确定自己的设置没有问题。")]),s._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[s._v("X-Content-Type-Options: nosniff\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("下面两种情况的请求将被阻止：")]),s._v(" "),t("ul",[t("li",[s._v('请求类型是"'),t("code",[s._v("style")]),s._v('" 但是 MIME 类型不是 "'),t("code",[s._v("text/css")]),s._v('"，')]),s._v(" "),t("li",[s._v('请求类型是"'),t("code",[s._v("script")]),s._v('" 但是 MIME 类型不是 '),t("a",{attrs:{href:"https://html.spec.whatwg.org/multipage/scripting.html#javascript-mime-type",target:"_blank",rel:"noopener noreferrer"}},[s._v("JavaScript MIME 类型"),t("OutboundLink")],1)])]),s._v(" "),t("h4",{attrs:{id:"_5、cache-control、expires、max-age"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、cache-control、expires、max-age"}},[s._v("#")]),s._v(" 5、Cache-control、Expires、max-age")]),s._v(" "),t("ul",[t("li",[s._v("Cache-control 用于控制HTTP缓存（在HTTP/1.0中可能部分没实现，仅仅实现了 Pragma: no-cache）")]),s._v(" "),t("li",[s._v("Expires 表示存在时间，允许客户端在这个时间之前不去检查（发请求），等同max-age的效果。但是如果同时存在，则被Cache-Control的max-age覆盖。")])]),s._v(" "),t("div",{staticClass:"language-http line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-http"}},[t("code",[s._v("Respense Headers\n"),t("span",{pre:!0,attrs:{class:"token header"}},[t("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("cache-control")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token header-value"}},[s._v("max-age=2592000           缓存的持续时间")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token header"}},[t("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("expires")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token header-value"}},[s._v("Thu, 04 Apr 2019 09:22:20 GMT   缓存的到期时间")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);